<html><head></head><body>
  <div id="_idContainer233">
    <h1 class="chapterNumber">11</h1>
    <h1 id="_idParaDest-215" class="chapterTitle">Combining Reinforcement Learning and Deep Learning</h1>
    <p class="normal">Amazon is one of the world's leading e-retailers, with sales over US$ 250 billion. Amazon's e-store sales exceed all of its other activities, such as AWS subscription services (premium, for example), retail third-party seller services, and physical stores.</p>
    <p class="normal">This chapter focuses on apparel production activity, one of Amazon's markets for which the company recently registered a patent. Prime Wardrobe even offers a try-and-easy-return service. This new activity requires planning and scheduling. Amazon took the matter seriously and registered a patent for an apparel manufacturing system to control the production process of its apparel products.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">Artificial intelligence already plays a role in automatic planning and scheduling in the apparel business, from customer orders through to delivery.</p>
    </div>
    <p class="normal">Google has successfully combined deep learning and reinforcement learning (Q-learning) in a <strong class="bold">deep Q-network</strong> (<strong class="bold">DQN</strong>), a system that can beat humans at video games and other tasks. Google's AlphaGo DQN has obtained impressive results.</p>
    <p class="normal">In this chapter, we go beyond merely describing Amazon's process or Google's process in particular. I added on my real-life implementations of what we will explore and build in Python from scratch. As such, we will combine the ideas of several systems (Amazon, Google, and my implementations). </p>
    <p class="normal">We will add an innovation for the apparel manufacturing industry by adding a <strong class="bold">conceptual representation learning metamodel</strong> (<strong class="bold">CRLMM</strong>) to reinforcement learning.</p>
    <p class="normal">We will go from scratch to a prototype that could be implemented on-site, the foundations are being established for further applications in the coming chapters.</p>
    <p class="normal">The following topics will be covered in this chapter:</p>
    <ul>
      <li class="list">Planning and scheduling today and tomorrow</li>
      <li class="list">Further generalization of the CRLMM described in <em class="italics">Chapter 10</em>, <em class="italics">Conceptual Representation Learning</em>, applied to an apparel production process</li>
      <li class="list">Feeding the CRLMM <strong class="bold">convolutional neural network (CNN)</strong> with a simulation of frames coming from a webcam on a production line</li>
      <li class="list">Introducing an optimizer that will use weights applied to production stations to input a reward matrix to a <strong class="bold">Markov decision process (MDP)</strong>, which will then update the weights</li>
      <li class="list">Building a program that will run continuously (no beginning, no end) on a production line using all the three components mentioned previously</li>
    </ul>
    <p class="normal">We'll begin by talking about planning and scheduling today and tomorrow. The market is slowing moving from preplanned processes to real-time processes. Let's see how.</p>
    <h1 id="_idParaDest-216" class="title">Planning and scheduling today and tomorrow</h1>
    <p class="normal">When Amazon decided to launch Prime Wardrobe, it brought a new service to its customers, enabling them to order, try out, and purchase clothing, shoes, and other accessories. The customer can establish a purchase plan. A purchase plan<a id="_idIndexMarker518"/> is a list of tasks to be carried out in a given time. An example of a purchase plan<a id="_idIndexMarker519"/> could be:</p>
    <ul>
      <li class="list">Filling a box with clothing</li>
      <li class="list">Trying on the clothing at home</li>
      <li class="list">Returning the clothing if it does not fit</li>
      <li class="list">Purchasing the items that are kept</li>
    </ul>
    <p class="normal">Once the customer agrees to follow this plan, the time sequence becomes crucial:</p>
    <ul>
      <li class="list">First, a box must be chosen.</li>
      <li class="list">Then, there is a delivery period.</li>
      <li class="list">Then, there is a trial period (you cannot try the products forever). During this period, the customer can choose not to purchase anything.</li>
      <li class="list">Finally, the customer confirms the purchase.</li>
    </ul>
    <p class="normal">Irrespective of whether Amazon Prime Wardrobe will remain a service in years to come, the precedent is set; just as physical book stores disappear every year, shopping for clothing online will continue to expand and occupy more of the market.</p>
    <p class="normal">On top of that distribution, corporations will continue to expand their production sites to become manufacturing-distributing giants. Warehouses will progressively replace many stores as per the warehouse examples provided in some of the chapters in this book.</p>
    <p class="normal"><strong class="bold">Supply chain management (SCM)</strong>, combined with APS, has become a necessity. SCM-APS constraints vary constantly on a global market (depending on the manufacturer). APS stands for advanced planning and scheduling or automated planning and scheduling. We will explore the difference between these two concepts in a following section, <em class="italics">A real-time manufacturing revolution</em>. We will go beyond Amazon's approach to the subject since delivering in real-time has become a constraint for all of the actors on the market.</p>
    <p class="normal">The pressure of the market has encouraged Amazon to produce its own clothing. Amazon has produced its in-house fashion labels with apparel and accessories sold worldwide.</p>
    <p class="normal">To prove that it means business, Amazon registered several patents, including one for a <em class="italics">blended reality mirror</em>, an apparel manufacturing system, and more. With a blended reality mirror, a person can visualize how the clothing will fit.</p>
    <p class="normal">In the following sections, we will explore the planning and scheduling side of Amazon's apparel in-house manufacturing plans, which will have the same effect on apparel factories as it did on physical book stores and all types of shops. Many new jobs will emerge, such as hundreds of thousands of jobs in the artificial intelligence business, on websites, and in marketing and SCM. Many jobs will disappear as well. The improvements made will boost medical progress and also the defense industry. The social and economic implications are beyond the scope of this book, and possibly beyond our comprehension, as in all disruptive eras in the past.</p>
    <p class="normal">We will focus in detail on the main aspects of Amazon's patented custom clothing process. As mentioned previously, irrespective of whether it proves successful, the precedent is set.</p>
    <h2 id="_idParaDest-217" class="title">A real-time manufacturing process</h2>
    <p class="normal">Today, a<a id="_idIndexMarker520"/> customer wants to obtain a purchased product as soon as possible. If the waiting time is too long, the customer will go somewhere else. Delivering in nearly real-time has become a key concept in marketing for any company. Amazon's approach has always been real-time. Pushing the physical limits of centuries of commerce, Amazon's brand takes the manufacturing process right beyond the cutting edge.</p>
    <h3 id="_idParaDest-218" class="title">Amazon must expand its services to face competition</h3>
    <p class="normal">Amazon could have <a id="_idIndexMarker521"/>avoided a great deal of upheaval if it continued to purchase products from its suppliers rather than manufacture them. Instead of researchers spending a great deal of time developing artificial intelligence capable of solving the conveyor belt problem, several sensors could be installed with traditional software solutions.</p>
    <p class="normal">Humanity could also have continued to use horses instead of cars and paper instead of computers. In the short term, we would have avoided a great deal of work and change associated with the requirements and impacts of these technologies. However, in the long term, it is progress and innovation that wins out.</p>
    <p class="normal">Once a disruptive<a id="_idIndexMarker522"/> innovation has been successfully launched by a company, the competition must either follow suit or disappear. Amazon needs to continue to get involved in the process that comes before simply storing goods in its warehouses. By getting involved in manufacturing, for example, they can reduce the time it takes to deliver a product to a customer. Amazon thus came up with this apparel manufacturing patent along with 3D printers, and other innovations to increase its productivity.</p>
    <p class="normal">In the same sense, the field of artificial intelligence needs to be pushed beyond its ever-expanding comfort zone constantly. Researchers must be confronted with difficult industrial problems to gain experience and produce new algorithms capable of achieving higher levels of machine learning and meeting greater challenges.</p>
    <h3 id="_idParaDest-219" class="title">A real-time manufacturing revolution</h3>
    <p class="normal">Artificial intelligence<a id="_idIndexMarker523"/> software, though spectacular, is not the only revolution that is changing our lives forever. In the 1950s and 1960s, the consumers were discovering the joy of purchasing new products such as dishwashers, color televisions, and cool radios. They were so happy to be able to obtain these products that they were willing to wait days if not weeks to obtain the exact model they dreamt of. The supplier could sit on an order for a few days and then get slowly to work.</p>
    <p class="normal">Today the consumer has lost that patience. If somebody wants to buy a product online, it has to be delivered within days. If not, the consumer will turn to another supplier. This puts pressure on the supplier, who must immediately start the process of delivering. Real-time is that process of starting to get things done in the seconds you are notified of a request.</p>
    <p class="normal">Real-time is a strong force that is changing every process in the world.</p>
    <p class="normal">Today, apparel manufacturing, and manufacturing in general, follow an advanced planning and scheduling process. "Advanced" means both a sophisticated algorithm and also an anticipating (planning in advance) process. The planning in advance aspect of AI algorithms is going through a revolution.</p>
    <p class="normal">Amazon, as all manufacturing processes, requires automated planning and scheduling to meet shortening delivery times.</p>
    <p class="normal">The fundamental difference between the two systems is the time factor, as shown in the following comparison table. The difference between an advanced and an automated system seems small, but Amazon, like others, will change the course of history through those differences. Both systems, in theory, can do both types of tasks. In practice, these methods will specialize in their niches in the years to come. To manufacture an airplane, a sophisticated <em class="italics">advanced</em> algorithm still needs to plan in <em class="italics">advance</em> (days to weeks) with a lot of manual decision making. To <a id="_idIndexMarker524"/>manufacture basic T-shirts, <em class="italics">automated</em> planning can be done quickly and automatically in real-time (seconds to hours)</p>
    <p class="normal">The trend of automated planning and scheduling is becoming a time-squashed version of advanced planning and scheduling. </p>
    <p class="normal">The figures in the following table do not reflect the exact numbers but the trends:</p>
    <table id="table001-8" class="No-Table-Style _idGenTablePara-1">
      <colgroup>
        <col/>
        <col/>
        <col/>
      </colgroup>
      <tbody>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <strong class="heading">Function</strong>
          </td>
          <td class="No-Table-Style">
            <strong class="heading">Advanced planning and scheduling</strong>
          </td>
          <td class="No-Table-Style">
            <strong class="heading">Automated planning and scheduling</strong>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">Long-term plan </p>
          </td>
          <td class="No-Table-Style">
            <p class="content">1 month to 5 years</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">A few days to less than a month</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">Short-term plan</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">1 day</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">1 minute</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">Production or event measurement</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Taken into account on a daily basis in general</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Real-time</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">Scheduling</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">1 hour to 1 week</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Real-time</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">Re-planning when there is a problem</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">1 hour to 1 month</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Real-time</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">Re-scheduling</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">1 hour to 1 week</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Real-time</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">Resource adjustment</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">1 day to 1 month</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Real-time</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">Load balancing</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">1 hour to 1 week</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">Real-time</p>
          </td>
        </tr>
        <tr class="No-Table-Style">
          <td class="No-Table-Style">
            <p class="content">Automatic functions of planning and scheduling</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">80%</p>
          </td>
          <td class="No-Table-Style">
            <p class="content">99%</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="normal">Although this table contains approximate information, the underlying trend is extremely strong. We've seen the differences between the concepts of advanced and automated; let's also clarify the differences between planning and scheduling:</p>
    <ul>
      <li class="list">A <strong class="bold">plan</strong> consists of <a id="_idIndexMarker525"/>processes preparing production for the future: purchasing material components and adapting human resources and physical resources. Amazon, for example, has a yearly business plan: putting together the necessary resources in advance to be ready for production. This implies purchasing or building warehouses, hiring employees, and purchasing basic material resources (boxes, labels, and other components).</li>
      <li class="list"><strong class="bold">Scheduling</strong> confronts<a id="_idIndexMarker526"/> the plan with the time factor on a shorter horizon. Scheduling determines when each part of the plan will come first and be produced. For example, now that the warehouse is built or purchased (plan), at what time (schedule) should packaging start working next Monday and for the weeks to come?<div class="packt_tip">
          <p>A schedule can be regarded as a zoomed-in version of a plan.</p>
        </div>
      </li>
    </ul>
    <p class="normal">If somebody walks into Jeff Bezos' office with a plan to build a warehouse at a given location with the cost and general timing of the implementation, that is fine. That person is presenting a two-year project. The project will start in 10 months and go on for two years.</p>
    <p class="normal">Then, that person <a id="_idIndexMarker527"/>might (I suggest not!) say: <em class="italics">The plan is great since it will be ready in 10 months. But I'm worried about the daily schedule in 1 year of shift #2 at 4 p.m. Should they start at 7:30 a.m. or 7:45?</em> Jeff Bezos will no longer be listening. That zoom level is not part of his job description. He has to focus on a higher level. It is useless for a top manager to know what's going to happen a year from now at 4 p.m.!</p>
    <div class="note">
      <p class="Information-Box--PACKT-">An advanced planning and scheduling system mostly imports data from ERPs to make plans in the future. An automated planning and scheduling program mostly detects data with sensors to react and optimize in real-time. The present chapter deals with automated planning programs, not advanced planning and scheduling systems.</p>
    </div>
    <p class="normal">Think of the evolution between an advanced APS and an automated APS as a logistic sigmoid function applied to planning-scheduling time squashing. Here are some examples:</p>
    <ul>
      <li class="list">The advanced plan to manufacture a car spans a month to a year.</li>
      <li class="list">The Google Maps itinerary automated plan for a self-driving car at its starting point: a few seconds to a minute, depending on the connection status of that location.</li>
      <li class="list">The schedule to manufacture a car: 1 day to 1 month.</li>
      <li class="list">The schedule to pilot a self-driving car following the Google Maps itinerary = <em class="italics">real-time</em></li>
    </ul>
    <p class="normal">To sum it up, the present trend represents a revolution in the history of human processes.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">Amazon's manufacturing patent reflects the revolution of real-time applied to every field.</p>
    </div>
    <p class="normal">Planning has moved up to planning in real-time, as shown in the following equation:</p>
    <figure class="mediaobject"><img src="../Images/B15483_11_001.png" alt=""/></figure>
    <p class="normal">In which:</p>
    <ul>
      <li class="list"><em class="italics">x</em> is a quantity to produce or any unit event.</li>
      <li class="list"><em class="italics">t</em><sub style="font-style: italic;">x</sub> is the time (<em class="italics">t</em>) it takes for <em class="italics">x</em> to start and end.</li>
      <li class="list">A logistic function squashes <em class="italics">t</em><sub style="font-style: italic;">x</sub>.</li>
      <li class="list"><img src="../Images/B15483_11_002.png" alt=""/> (lambda) is the <a id="_idIndexMarker528"/>learning factor; the more a task is carried out, the more it is optimized.</li>
    </ul>
    <p class="normal"><em class="italics">X</em><sub style="font-style: italic;">t</sub> is the total weight of a group of <em class="italics">n</em> tasks at a given time <em class="italics">t</em>:</p>
    <p class="center"><em class="italics">X</em><sub style="font-style: italic;">t</sub> = {<em class="italics">x</em><sub>1</sub>, <em class="italics">x</em><sub>2</sub>, <em class="italics">x</em><sub>3</sub> … <em class="italics">x</em><sub style="font-style: italic;">n</sub>}</p>
    <p class="normal">The difference between <em class="italics">X</em><sub style="font-style: italic;">t</sub> and <em class="italics">Z</em>(<em class="italics">X</em><sub style="font-style: italic;">t</sub>) is:</p>
    <ul>
      <li class="list"><em class="italics">X</em><sub style="font-style: italic;">t</sub> is the actual time it takes to manufacture products.</li>
      <li class="list"><em class="italics">Z</em>(<em class="italics">X</em><sub style="font-style: italic;">t</sub>) is not the actual time it takes. <em class="italics">Z</em>(<em class="italics">X</em><sub style="font-style: italic;">t</sub>) is the result of an activation function that squashes time as an output of <em class="italics">X</em><sub style="font-style: italic;">t</sub> in an RL-DL-CRLMM network. <em class="italics">Z</em>(<em class="italics">X</em><sub style="font-style: italic;">t</sub>) is a weighting factor.</li>
    </ul>
    <p class="normal">The key to reducing the weighting factor further is a physical production process and other physical events (outputs, for example), that I call lambda: <img src="../Images/B15483_11_003.png" alt=""/> signifies all the improvements in real-life production that can reduce the production cycle as well as the natural events, such as production output.</p>
    <p class="normal">In <em class="italics">Chapter 10</em>, <em class="italics">Conceptual Representation Learning</em>, <img src="../Images/B15483_11_004.png" alt=""/> was introduced to reduce gaps. In this chapter, <img src="../Images/B15438_10_003.png" alt=""/> will be generalized a step further to optimize <img src="../Images/B15483_11_006.png" alt=""/>.</p>
    <p class="normal">This means that an RL-DL-CRLMM system will optimize the manufacturing process. We will now explore a game-changing automated apparel manufacturing process and build it in Python.</p>
    <h1 id="_idParaDest-220" class="title">CRLMM applied to an automated apparel manufacturing process</h1>
    <p class="normal">With an automated<a id="_idIndexMarker529"/> planning and scheduling<a id="_idIndexMarker530"/> system, not an advanced planning and scheduling system, Amazon has brought apparel manufacturing closer to the consumer.</p>
    <p class="normal">Artificial intelligence will boost existing processes. In this section, an RL-DL-CRLMM system will optimize an apparel manufacturing process.</p>
    <h2 id="_idParaDest-221" class="title">An apparel manufacturing process</h2>
    <p class="normal">Amazon's <a id="_idIndexMarker531"/>apparel manufacturing patent can be summarized as follows:</p>
    <ul>
      <li class="list"><strong class="bold">P1</strong>: Grouping apparel customer orders by products and sizes. This process has been around since the origins of industrial apparel manufacturing centuries ago.</li>
      <li class="list"><strong class="bold">P2</strong>: Automatically cutting lays. A lay is a stack of pieces of cloth. It is like cutting a circle in a stack (lay) of several pieces of paper at the same time.</li>
      <li class="list"><strong class="bold">P3</strong>: Moving the packs of the parts of clothing to the assembly lines on conveyor belts (see <em class="italics">Chapter 10</em>, <em class="italics">Conceptual Representation Learning</em>).</li>
      <li class="list"><strong class="bold">P4</strong>: Other operations depending on the products (packaging or printing or other).</li>
      <li class="list"><strong class="bold">P5</strong>: Storing and optimizing the distribution process through warehouses and deliveries and many more processes (tracking and data analysis, for example, finding late deliveries and optimizing their routes).</li>
    </ul>
    <p class="normal">The following diagram represents the production flow at an apparel manufacturing company. First, the fabric is cut, and then it is stacked in piles and sent by a conveyor belt to sewing stations to assemble the clothing:</p>
    <figure class="mediaobject"><img src="../Images/B15438_11_01.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.1: Apparel production flow</p>
    <p class="normal">A webcam is set up <a id="_idIndexMarker532"/>right over P3, the conveyor belt. The following image represents the webcam above the conveyor belt:</p>
    <figure class="mediaobject"><img src="../Images/B15438_11_02.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.2: Webcam freezing frames on a conveyor belt</p>
    <p class="normal">The webcam freezes a frame (within the red rectangle) every <em class="italics">n</em> seconds. The frame is the input of the CRL-CNN described later.</p>
    <p class="normal">This image is a representation of the concepts. In reality, the webcam may be located at the beginning of the conveyor belt, or even over the output of the cutting process. For the prototype in this chapter, keep in mind that every <em class="italics">n</em> seconds, a frozen frame is sent to the trained CNN.</p>
    <p class="normal">This P1 to P5 flowchart provides a general idea of an apparel manufacturing process. In an actual company, many more processes are required: market studies, designing products, testing prototypes, adding manufacturing processes for jeans (making holes with a laser, for example), and much more.</p>
    <p class="normal">Every process <a id="_idIndexMarker533"/>described so far was invented individually 30+ years ago, including automatic cutting and conveyor belts applied to the apparel business. <em class="italics">What's new here?</em> springs to mind in the case of many apparel experts reading about Amazon. And that is the mind trap! Thinking that Amazon's apparel patent does not contain new components is a mistake.</p>
    <p class="normal"><strong class="bold">Time squashing</strong> is the <a id="_idIndexMarker534"/>core of the Amazon innovation process. Bringing manufacturing closer to the consumer in near-real time is a revolution that will become disruptive. Add 3D printers to the time squashing equation, and you will easily picture the future of our consumer markets. However, artificial intelligence has the right to enter the optimizing competition as well.</p>
    <p class="normal">To illustrate this, let's build an AI model that optimizes P3, the conveyor belt. Many solutions already exist as well, but an RL+DL can most probably beat them just as it will in many fields.</p>
    <p class="normal">The first step is to generalize the <img src="../Images/B15483_11_007.png" alt=""/> model described in <em class="italics">Chapter 10</em>, <em class="italics">Conceptual Representation Learning</em>, a bit further through training. Then, the RL-DL-CRLMM can be built. We will first explore how the CRLMM is trained to analyze web frames in production.</p>
    <h2 id="_idParaDest-222" class="title">Training the CRLMM</h2>
    <p class="normal"><em class="italics">Chapter 10</em>, <em class="italics">Conceptual Representation Learning</em>, introduced CRLMMs using <img src="../Images/B15438_10_010.png" alt=""/> (gap concepts) to<a id="_idIndexMarker535"/> illustrate one.</p>
    <p class="normal">In the previous chapters, conceptual subsets around <img src="../Images/B15438_10_022.png" alt=""/> (gap concepts) were designed as follows:</p>
    <ul>
      <li class="list"><img src="../Images/B15483_11_010.png" alt=""/>, which contains <em class="italics">pg</em><sub style="font-style: italic;">i</sub> (<em class="italics">p</em> = positive) and <em class="italics">ng</em><sub style="font-style: italic;">i</sub> (<em class="italics">n</em> = negative subsets)</li>
      <li class="list"><em class="italics">ng</em><sub>1</sub> is a subset of <img src="../Images/B15483_11_011.png" alt=""/>; <em class="italics">ng</em><sub>1</sub> = {missing, not enough, slowing production down … bad},</li>
      <li class="list"><em class="italics">pg</em><sub>2</sub> is a subset of <img src="../Images/B15483_11_007.png" alt=""/>; <em class="italics">pg</em><sub>2</sub> = <em class="italics">pg</em><sub>2</sub> = {good production flow, no gap}</li>
      <li class="list"><em class="italics">g</em><sub>2</sub> = {loaded}</li>
      <li class="list"><em class="italics">g</em><sub>3</sub> = {unloaded},</li>
      <li class="list"><em class="italics">pg</em><sub>4</sub> = {traffic jam, heavy traffic … too much traffic}</li>
      <li class="list"><em class="italics">ng</em><sub>5</sub> = {open lane, light traffic … normal traffic}</li>
    </ul>
    <p class="normal"><code class="Code-In-Text--PACKT-">CNN_STRATEGY_MODEL.py</code> needs to be trained to recognize <img src="../Images/B15483_11_013.png" alt=""/> in an apparel production environment as <a id="_idIndexMarker536"/>well as remember how to recognize former <img src="../Images/B15438_10_028.png" alt=""/> concepts:</p>
    <ul>
      <li class="list">The cutting section P2 (A and B) output of apparel packs flowing on a conveyor belt (P3).</li>
      <li class="list">Remember how to classify the cakes of the food processing company to teach the model to recognize more situations.</li>
      <li class="list">Remember how to perform a traffic analysis (see <em class="italics">Chapter 10</em>, <em class="italics">Conceptual Representation Learning</em>).</li>
      <li class="list">Learn how to be able to classify an abstract representation of a gap.</li>
    </ul>
    <h3 id="_idParaDest-223" class="title">Generalizing the unit training dataset</h3>
    <p class="normal">To generalize the unit <a id="_idIndexMarker537"/>training dataset, six types of images were created. Each image represents a webcam frame taken over a conveyor belt every <em class="italics">n</em> seconds. Four images are figurative in the sense of figurative painting. Two images bring the CRLMM program to a higher level of abstraction.</p>
    <h3 id="_idParaDest-224" class="title">Food conveyor belt processing – positive p<img src="../Images/B15483_11_015.png" alt=""/> and negative n<img src="../Images/B15483_11_016.png" alt=""/> gaps</h3>
    <p class="normal">In the<a id="_idIndexMarker538"/> food processing industry example (see <em class="italics">Chapter 9</em>, <em class="italics">Abstract Image Classification with Convolutional Neural Networks (CNNs)</em>, a gap on the conveyor belt was most often negative, a <em class="italics">negative gamma</em> = <em class="italics">n<img src="../Images/B15483_11_017.png" alt=""/></em>.</p>
    <p class="normal">The following frame shows that the first line of production is complete, but not lines two and three:</p>
    <figure class="mediaobject"><img src="../Images/B15438_11_03.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.3: Food conveyor belt processing frame</p>
    <p class="normal">On the contrary, with approximately no gaps, the load on the conveyor belt was viewed as positive, a <em class="italics">positive gamma</em> = <em class="italics">p<img src="../Images/B15483_11_018.png" alt=""/></em>.</p>
    <p class="normal">The following frame shows that there is an acceptable number of products per line:</p>
    <figure class="mediaobject"><img src="../Images/B15438_11_04.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.4: Food conveyor belt processing frame</p>
    <p class="normal">As the preceding images show, whatever the product is on a conveyor belt, a gap remains a gap, an empty space. We will now apply our model to other gaps whatever the object may be. In this case, we will detect gaps on an apparel conveyor belt.</p>
    <h4 class="title">Apparel conveyor belt processing – undetermined gaps</h4>
    <p class="normal">A gap in an apparel conveyor belt process<a id="_idIndexMarker539"/> is most often undetermined. This constitutes a major optimization problem in itself. Naturally, if the conveyor belt is empty or saturated, the variance will attract the attention of a human operator. However, most of the time, optimization solves the problem.</p>
    <p class="normal">The following frame shows a relatively well-loaded production flow of apparel packs of pieces of clothing to be assembled (by sewing them together) further down the line:</p>
    <figure class="mediaobject"><img src="../Images/B15438_11_05.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.5: Well-loaded production flow</p>
    <p class="normal">The following frame clearly shows a gap, meaning that the quantity that will be sent to a sewing station will not be high:</p>
    <figure class="mediaobject"><img src="../Images/B15438_11_06.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.6: Production flow (gap)</p>
    <p class="normal">Several <a id="_idIndexMarker540"/>observations are necessary to optimize this problem:</p>
    <ul>
      <li class="list">The conveyor belt real-time problem excludes running advanced planning and scheduling.</li>
      <li class="list">This problem requires real-time automated planning and scheduling.</li>
      <li class="list">The automated planning and scheduling solution will have to both plan and schedule in real-time.</li>
      <li class="list">It will take planning constraints into account (as explained in the following sections) to predict outputs.</li>
      <li class="list">It will take scheduling constraints into account to optimize the sewing sections.</li>
    </ul>
    <p class="normal">Amazon and others have slowly, but surely, brought many planning horizon problems (longer) down to shorter scheduling horizons, pushing the limits of SCM further and further.</p>
    <h4 class="title">The beginning of an abstract notion of gaps</h4>
    <p class="normal">The gaps shown have <a id="_idIndexMarker541"/>negative or positive properties depending on the context. The CRLMM model now has to learn a meta conceptual abstract representation of all the gaps mentioned hitherto. These gaps are all flow gaps of one sort or another. Something is moving from one point to another in small packs. The packs, therefore, are often not the same size, and this causes gaps to form.</p>
    <p class="normal">These concepts can be applied to cattle herds, horse races, team sport attacks (football, soccer, rugby, basketball, handball, and other fields), Olympic races, marathons, conveyor belts, and much more.</p>
    <p class="normal">When the packs in the flow are close to each other, an individual mental image crops up. Each person has a customized version. The following image is a generalized representation of a no-gap concept:</p>
    <figure class="mediaobject"><img src="../Images/B15438_11_07.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.7: A generalized representation of a no-gap concept</p>
    <p class="normal">Then, the packs have leaders and followers. Then, an abstract representation comes up as well. The following image shows a generalized representation of a gap concept:</p>
    <figure class="mediaobject"><img src="../Images/B15438_11_08.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.8: A generalized representation of a gap concept</p>
    <p class="normal">Humans do not have a<a id="_idIndexMarker542"/> flow detection gap function for each thing they are observing. Humans have one brain that contains physical memories or other datasets, but, more importantly, they have abstract datasets.</p>
    <p class="normal">Every single one of us billions of thinking bipeds has extremely efficient abstract datasets. The meta-concept shown previously means that through inferences, a human has a central meta-concept with a dataset of memories that fit with it through experience.</p>
    <p class="normal">A meta-model uses these datasets. The dataset in the <code class="Code-In-Text--PACKT-">dataset</code> directory contains the beginning of a CRLMM system. The program will learn what a <em class="italics">flow gap</em> is and then apply it to what it sees by analyzing the context.</p>
    <p class="normal">This goal of this dataset leads to a CRLMM, as explained in the following sections in which:</p>
    <ul>
      <li class="list">The abstract learned meta-concept is applied to a situation; in this case, a frame.</li>
      <li class="list">The CRLMM then determines whether it is a gap or no-gap situation.</li>
      <li class="list">The CRLMM then makes a decision, using a thinking optimizer based on a decision weight-orientated activation function. This means that it is more than a mathematical <em class="italics">squash</em>. It's <em class="italics">weighing</em> the pros and cons of a decision-making process.</li>
    </ul>
    <p class="normal">In this section, our CRLMM has learned to identify gaps on an apparel conveyor belt. If we were to implement this, we would add many web frames of a conveyor belt of our project to our datasets to do the training. For now, let us continue with this example and run a prediction program to classify the gaps.</p>
    <h3 id="_idParaDest-225" class="title">Running a prediction program</h3>
    <p class="normal">The training was <a id="_idIndexMarker543"/>done with the same <code class="Code-In-Text--PACKT-">CNN_STRATEGY_MODEL.py</code> program described in <em class="italics">Chapter 9</em>, <em class="italics">Abstract Image Classification with Convolutional Neural Networks (CNNs)</em>, which was designed to be generalized for subsequent chapters.</p>
    <p class="normal">Once the dataset of the previous section has been installed, the model can make predictions with no further training in various domains.</p>
    <p class="normal">The same <code class="Code-In-Text--PACKT-">CNN_CONCEPT_STRATEGY.py</code> functions described in <em class="italics">Chapter 10</em>, <em class="italics">Conceptual Representation Learning</em>, were implemented.</p>
    <p class="normal">Only the path to the dataset was changed, along with the prediction messages to display:</p>
    <pre class="programlisting"><code class="hljs routeros"><span class="hljs-comment">#II. Convolutional Neural Network (CNN)</span>
<span class="hljs-comment">#loads,traffic,food processing</span>
A=[<span class="hljs-string">'dataset_O/'</span>,<span class="hljs-string">'dataset_traffic/'</span>,<span class="hljs-string">'dataset/'</span>]
MS1=[<span class="hljs-string">'loaded'</span>,<span class="hljs-string">'jammed'</span>,<span class="hljs-string">'productive'</span>]
MS2=[<span class="hljs-string">'unloaded'</span>,<span class="hljs-string">'change'</span>,<span class="hljs-string">'gap'</span>]
<span class="hljs-attribute">display</span>=1     #display images
<span class="hljs-attribute">scenario</span>=2    #reference <span class="hljs-keyword">to</span> A,MS1,MS2
<span class="hljs-attribute">directory</span>=A[scenario] #transfer learning parameter (choice of images)
<span class="hljs-attribute">CRLMN</span>=1       # concept learning
<span class="hljs-builtin-name">print</span>(<span class="hljs-string">"Classifier frame directory"</span>,directory)
</code></pre>
    <p class="normal">The CRLMM has now learned to represent real-life memories and inference of the associated memories in a meta-concept. Our CRLMM is ready to be assembled as one of the three components of RL-DL-CRLMM as we will see in the next section.</p>
    <h1 id="_idParaDest-226" class="title">Building the RL-DL-CRLMM</h1>
    <p class="normal">The full code of the <a id="_idIndexMarker544"/>RL-DL-CRLMM program is <code class="Code-In-Text--PACKT-">RL_DL.py</code>. It is built on the knowledge and programs of the previous chapters and previous sections of this chapter.</p>
    <p class="normal">The RL-DL-CRLMM <a id="_idIndexMarker545"/>contains three components:</p>
    <ul>
      <li class="list">A CRLMM convolutional network that will analyze each frame it receives from the webcam that is located right over the pieces of garment packs on the conveyor belt coming from the cutting section.</li>
      <li class="list">An optimizer using a modified version of the <em class="italics">Z</em>(<em class="italics">X</em>) described previously that plans how the assembly stations will be loaded in real-time.</li>
      <li class="list">An MDP<a id="_idIndexMarker546"/> that will receive the input of the optimizer function and schedule the work of the assembly stations. It also produces the modified <em class="italics">Z</em>(<em class="italics">X</em>) updated value of the weights of each assembly station for the next frame.</li>
    </ul>
    <p class="normal">In the physical world, the conveyor belt transports the garment packs, a picture (frame) is taken every <em class="italics">n</em> seconds, and the RL-DL-CRLMM runs. The output of the RL-DL-CRLMM sends instructions to the conveyor belt and directs the garment packs to the optimized load of the assembly stations, as explained before.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">Since <code class="Code-In-Text--PACKT-">RL_DL.py</code> describes a continuous RL-DL-CRLMM process, there is no beginning or end to the program. The components are independent and are triggered by the input sent to them, and they trigger others with their output.</p>
    </div>
    <p class="normal">Thus, components will <a id="_idIndexMarker547"/>be described in the processing order but not in the code-in-line order. This is because the functions defined by <code class="Code-In-Text--PACKT-">def</code> + <code class="Code-In-Text--PACKT-">function()</code> precede the function calls to them. Code line numbers will thus be inserted in the comments following the code line like this: <code class="Code-In-Text--PACKT-"># [Line 38]</code>.</p>
    <h2 id="_idParaDest-227" class="title">A circular process</h2>
    <p class="normal">Once the three main<a id="_idIndexMarker548"/> components of the system are in place (CNN, MDP, optimizer), the circular property of this RL-DL-CRLMM is a stream-like system that never starts nor ends.</p>
    <p class="normal">To define a circular process, let's take an everyday example. Customer C goes to the supermarket to purchase a product. The product was previously stored in a warehouse that we will name B. A factory named A manufactures this product. If you look at the whole supply chain at a given time, you will see there is no starting or ending point:</p>
    <ul>
      <li class="list">If you are A, you are both monitoring the needs of C to send products to B</li>
      <li class="list">If you are B, you are both monitoring what is coming from A to satisfy C</li>
      <li class="list">If you are C, you are creating a demand for A to deliver B</li>
    </ul>
    <p class="normal">In a real-life supply chain, there is no beginning and no end. The same applies to an automated production site to the flow of functions in this virtually memoryless system. The conveyor belt's webcam<a id="_idIndexMarker549"/> provides a stream of frames, forcing the system into circular stream-like behavior.</p>
    <h2 id="_idParaDest-228" class="title">Implementing a CNN-CRLMM to detect gaps and optimize</h2>
    <p class="normal">The CNN-CRLMM function was described in the <em class="italics">Running a prediction program</em> section and in <em class="italics">Chapter 10</em>, <em class="italics">Conceptual Representation Learning</em>. The prediction function is part of the MDP output analysis described later. The <code class="Code-In-Text--PACKT-">CRLMM</code> function is called as shown in the following code:</p>
    <pre class="programlisting"><code class="hljs ruby"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">CRLMM</span><span class="hljs-params">(Q,lr,e)</span></span>:    <span class="hljs-comment"># [Line 180]</span>
</code></pre>
    <p class="normal">The first part of this <a id="_idIndexMarker550"/>function squashes the <em class="italics">W</em> vector described in the following section. The second part of this function analyzes the input frame.</p>
    <p class="normal">Since no webcam is connected to the system at this point (that must be done during project implementation), a random image (frame) choice is made. The following random code simulates the random occurrences of real-life production:</p>
    <pre class="programlisting"><code class="hljs angelscript">    status=random.randint(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>)
</code></pre>
    <p class="normal">In a real-life situation, random quantities will be going through the conveyor belt. With the status having being determined, the CNN simulates the addition of a frozen frame from the video stream coming from the webcam located directly on the conveyor belt. It runs the identity (image) function described before and returns a <code class="Code-In-Text--PACKT-">gap</code> or <code class="Code-In-Text--PACKT-">no gap</code> scenario for the optimizer (refer to the optimizer section). The following code describes a gap identification process:</p>
    <pre class="programlisting"><code class="hljs routeros">    <span class="hljs-keyword">if</span>(<span class="hljs-attribute">status</span>==0):
        #<span class="hljs-builtin-name">Add</span> frame <span class="hljs-keyword">from</span> video stream (connect <span class="hljs-keyword">to</span> webcam)
        <span class="hljs-attribute">s</span>=identify(directory+'classify/img1.jpg',e)
    <span class="hljs-keyword">if</span>(<span class="hljs-attribute">status</span>==1):
        #<span class="hljs-builtin-name">Add</span> frame <span class="hljs-keyword">from</span> video stream (connect <span class="hljs-keyword">to</span> webcam)
        <span class="hljs-attribute">s</span>=identify(directory+'classify/img2.jpg',e)
    <span class="hljs-attribute">s1</span>=int(s[0])
    <span class="hljs-keyword">if</span> (int(s1)==0):
        <span class="hljs-builtin-name">print</span>(<span class="hljs-string">'Classified in class A'</span>)
        <span class="hljs-builtin-name">print</span>(MS1[scenario])
        <span class="hljs-builtin-name">print</span>(<span class="hljs-string">'Seeking...'</span>)
    <span class="hljs-keyword">if</span> (int(s1)==1):
        <span class="hljs-builtin-name">print</span>(<span class="hljs-string">'Classified in class B'</span>)
        <span class="hljs-builtin-name">print</span>(MS2[scenario])
    return s1
</code></pre>
    <p class="normal">Once <code class="Code-In-Text--PACKT-">status</code> has been detected, irrespective of whether the load output of the cutting system is high or low, a decision must be made. This will be done with the MDP.</p>
    <h2 id="_idParaDest-229" class="title">Q-learning – MDP</h2>
    <p class="normal">By adding an<a id="_idIndexMarker551"/> MDP Q-learning decision function (see <em class="italics">Chapter 1</em>, <em class="italics">Getting Started with Next-Generation Artifcial Intelligence through Reinforcement Learning</em>) in this CNN-CRLMM program, we are now entering the world of cognitive RL-DL programs.</p>
    <div class="note">
      <p class="Information-Box--PACKT-">In this real-time system, there is no beginning, no end, and no real memory beyond a few frames.</p>
    </div>
    <p class="normal">The <code class="Code-In-Text--PACKT-">mdp01.py</code> MDP program has been incorporated into <code class="Code-In-Text--PACKT-">RL_DL.py</code>. Thus, only the changes made are described in this chapter.</p>
    <p class="normal">MDP parameters come right after the import packages. Each vertex of the graph has its letter and location, as shown in the following code snippet:</p>
    <pre class="programlisting"><code class="hljs ini"><span class="hljs-attr">L</span>=[<span class="hljs-string">'A'</span>,<span class="hljs-string">'B'</span>,<span class="hljs-string">'C'</span>,<span class="hljs-string">'D'</span>,<span class="hljs-string">'E'</span>,<span class="hljs-string">'F'</span>]    <span class="hljs-comment"># [Line 37]</span>
</code></pre>
    <p class="normal">When the program runs, the following graph will be displayed with red (target vertices) for this frame. It is then up to the MDP to choose, described as follows:</p>
    <figure class="mediaobject"><img src="../Images/B15438_11_09.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.9: Output (target vertices)</p>
    <p class="normal">Notice that this is an undirected graph with vertices (the colored dots) and no edge (lines) directions. The MDP will provide directions for each frame in this model.</p>
    <p class="normal">Each vertex represents an assembly station in this model. Each assembly station has a high workload or a low workload. The workload is rarely stabilized because products keep flowing in and out as they are produced.</p>
    <h3 id="_idParaDest-230" class="title">MDP inputs and outputs</h3>
    <p class="normal">The MDP process in this model uses a reward matrix as an input and produces a weight vector.</p>
    <h4 class="title">The input is a neutral reward matrix</h4>
    <p class="normal">The MDP reward matrix is set to <code class="Code-In-Text--PACKT-">0</code>, except for the values representing the edges of the graph that can be physically accessed; these are set to <code class="Code-In-Text--PACKT-">1</code>, a small neutral value.</p>
    <p class="normal">As it is, the <a id="_idIndexMarker552"/>MDP cannot provide a satisfactory result beyond reproducing the structure of this undirected graph. The reward matrix is now initialized and duplicated as shown in the following code, starting from line 41; at line 43, <code class="Code-In-Text--PACKT-">R</code>, the reward matrix is built, and at <code class="Code-In-Text--PACKT-">Ri</code>, a duplicate of <code class="Code-In-Text--PACKT-">R</code> is created:</p>
    <pre class="programlisting"><code class="hljs angelscript"># R <span class="hljs-keyword">is</span> The Reward Matrix <span class="hljs-keyword">for</span> each state built on the physical graph    [Line <span class="hljs-number">41</span>]
# Ri <span class="hljs-keyword">is</span> a memory of <span class="hljs-keyword">this</span> initial state: no rewards <span class="hljs-keyword">and</span> undirected
R = ql.matrix([[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>],
               [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],
               [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],
               [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>],
               [<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],
               [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]])
Ri = ql.matrix([[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>],
                [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],
                [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],
                [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>],
                [<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>],
                [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]])
</code></pre>
    <p class="normal"><code class="Code-In-Text--PACKT-">Ri</code> is a copy of the initial-state zero-reward matrix. <code class="Code-In-Text--PACKT-">R</code> is reset to <code class="Code-In-Text--PACKT-">Ri</code> at every new frame. MDP trains the assembly location plan for each new frame in a memoryless, undirected graph and unsupervised approach.</p>
    <p class="normal"><code class="Code-In-Text--PACKT-">Q</code> is the learning matrix in which rewards will be learned/stored, as shown in the code on line 58:</p>
    <pre class="programlisting"><code class="hljs angelscript">Q = ql.matrix(ql.zeros([<span class="hljs-number">6</span>,<span class="hljs-number">6</span>]))    # [Line <span class="hljs-number">58</span>]
</code></pre>
    <h4 class="title">The standard output of the MDP function</h4>
    <p class="normal">The load of the<a id="_idIndexMarker553"/> assembly stations is not the <a id="_idIndexMarker554"/>exact quantity produced. They are weights that are updated continuously during this continuous process, as explained further in the chapter.</p>
    <p class="normal">At an initial state of the program, the initial weight of the vertices is set to <code class="Code-In-Text--PACKT-">0</code> in the following line of code (line 40):</p>
    <pre class="programlisting"><code class="hljs angelscript">W=[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]    # [Line <span class="hljs-number">40</span>]
</code></pre>
    <p class="normal">The weight vector (represented as an array) contains one value per assembly station location or vertex.</p>
    <p class="normal">An initial state is not a real beginning. It is like a pause button on a video. The initial state can come from a holiday (no production), a maintenance day (no production), or a lack of input orders (no production). The initial state is just a case when the weights are equal to <code class="Code-In-Text--PACKT-">0</code> because there is nothing on the conveyor or assembly stations.</p>
    <p class="normal">The weight vector is part 1 of <a id="_idIndexMarker555"/>the optimizer (see the following section). The MDP produces an output matrix after having optimized the undirected graph. The optimizer will have provided a target.</p>
    <p class="normal">The program contains the<a id="_idIndexMarker556"/> same source code as in <em class="italics">Chapter 1</em>, <em class="italics">Getting Started with Next-Generation Artifcial Intelligence through Reinforcement Learning</em>, with Bellman's equation starting from line 1166. The MDP produces its result, as shown in the following output:</p>
    <pre class="programlisting"><code class="hljs yaml"><span class="hljs-string">[[</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">105.352</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-string">]</span>
<span class="hljs-string">[</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">130.44</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">201</span><span class="hljs-string">.</span> <span class="hljs-string">]</span>
<span class="hljs-string">[</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">130.44</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-string">]</span>
<span class="hljs-string">[</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">161.8</span> <span class="hljs-number">105.352</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">105.352</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-string">]</span>
<span class="hljs-string">[</span> <span class="hljs-number">85.2816</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">130.44</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-string">]</span>
<span class="hljs-string">[</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">250</span><span class="hljs-string">.</span> <span class="hljs-string">]]</span>
<span class="hljs-attr">Normed Q :</span>
<span class="hljs-string">[[</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">42.1408</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-string">]</span>
<span class="hljs-string">[</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">52.176</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">80.4</span> <span class="hljs-string">]</span>
<span class="hljs-string">[</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">52.176</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-string">]</span>
<span class="hljs-string">[</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">64.72</span> <span class="hljs-number">42.1408</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">42.1408</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-string">]</span>
<span class="hljs-string">[</span> <span class="hljs-number">34.11264</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">52.176</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-string">]</span>
<span class="hljs-string">[</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">100</span><span class="hljs-string">.</span> <span class="hljs-string">]]</span>
</code></pre>
    <p class="normal">Bear in mind that this entire DQN-CRLMM is not only based on the undirected memoryless MDP function but also has no real beginning nor end since it's a continuous and virtually memoryless process.</p>
    <h4 class="title">A graph interpretation of the MDP output matrix</h4>
    <p class="normal">After <a id="_idIndexMarker557"/>each run, the MDP matrix also produces a graph interpretation of the values of paths between the vertices from point to point (letter to letter), and displays it in the following output:</p>
    <pre class="programlisting"><code class="hljs yaml"><span class="hljs-attr">State of frame :</span> <span class="hljs-number">3</span> <span class="hljs-string">D</span>
<span class="hljs-number">0</span> <span class="hljs-string">A</span> <span class="hljs-string">E</span> <span class="hljs-number">161.8</span>
<span class="hljs-number">1</span> <span class="hljs-string">B</span> <span class="hljs-string">D</span> <span class="hljs-number">201.0</span>
<span class="hljs-number">2</span> <span class="hljs-string">C</span> <span class="hljs-string">D</span> <span class="hljs-number">201.0</span>
<span class="hljs-number">3</span> <span class="hljs-string">D</span> <span class="hljs-string">D</span> <span class="hljs-number">250.0</span>
<span class="hljs-number">4</span> <span class="hljs-string">E</span> <span class="hljs-string">A</span> <span class="hljs-number">130.44</span>
<span class="hljs-number">4</span> <span class="hljs-string">E</span> <span class="hljs-string">D</span> <span class="hljs-number">201.0</span>
<span class="hljs-number">5</span> <span class="hljs-string">F</span> <span class="hljs-string">B</span> <span class="hljs-number">161.8</span>
</code></pre>
    <p class="normal">This way, if the values are taken from the highest to the lowest edges (lines and, hence, values between two letters), it gives a visual idea of how the MDP function calculated its way through the graph.</p>
    <p class="normal"><code class="Code-In-Text--PACKT-">RL</code> is the letter vector. It is empty after each frame. It will be filled by finding the values of each edge. It will contain the letters of the vertices (nodes and dots) connected by the edges (lines represented by the values).</p>
    <p class="normal"><code class="Code-In-Text--PACKT-">RN</code> is the value <a id="_idIndexMarker558"/>of the edges. The following code shows how to implement <code class="Code-In-Text--PACKT-">RL</code> and <code class="Code-In-Text--PACKT-">RN</code> and update the weights of the locations in the weight vector (<code class="Code-In-Text--PACKT-">W</code>):</p>
    <pre class="programlisting"><code class="hljs prolog">    #<span class="hljs-symbol">Graph</span> structure    [<span class="hljs-symbol">Line</span> <span class="hljs-number">187</span>]
    <span class="hljs-symbol">RL</span>=[<span class="hljs-string">''</span>,<span class="hljs-string">''</span>,<span class="hljs-string">''</span>,<span class="hljs-string">''</span>,<span class="hljs-string">''</span>,<span class="hljs-string">''</span>]
    <span class="hljs-symbol">RN</span>=[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]
    print(<span class="hljs-string">"State of frame :"</span>,lr,<span class="hljs-symbol">L</span>[lr])
    for i in range(<span class="hljs-number">6</span>):
        maxw=<span class="hljs-number">0</span>
        for j in range(<span class="hljs-number">6</span>):
            <span class="hljs-symbol">W</span>[j]+=logistic_sigmoid(<span class="hljs-symbol">Q</span>[i,j])
            if(<span class="hljs-symbol">Q</span>[i,j]&gt;maxw):
                <span class="hljs-symbol">RL</span>[i]=<span class="hljs-symbol">L</span>[j]
                <span class="hljs-symbol">RN</span>[i]=<span class="hljs-symbol">Q</span>[i,j]
                maxw=<span class="hljs-symbol">Q</span>[i,j]
                print(i,<span class="hljs-symbol">L</span>[i],<span class="hljs-symbol">RL</span>[i],<span class="hljs-symbol">RN</span>[i])
</code></pre>
    <p class="normal">The logistic function in the preceding code is being updated while <code class="Code-In-Text--PACKT-">RL</code> and <code class="Code-In-Text--PACKT-">RN</code> are being updated.</p>
    <h2 id="_idParaDest-231" class="title">The optimizer</h2>
    <p class="normal">I have written several <a id="_idIndexMarker559"/>optimizers for fabric optimization in the apparel industry. In this case, the optimizer will be used to regulate the flow of production.</p>
    <p class="normal">The term "optimizer" is not the CNN <code class="Code-In-Text--PACKT-">rmsprop</code> optimizer used in the previous chapters represented with the following code:</p>
    <pre class="programlisting"><code class="hljs routeros">loaded_model.compile(<span class="hljs-attribute">loss</span>=<span class="hljs-string">'binary_crossentropy'</span>, <span class="hljs-attribute">optimizer</span>=<span class="hljs-string">'rmsprop'</span>, metrics=[<span class="hljs-string">'accuracy'</span>])    # [Line 92]
</code></pre>
    <p class="normal">The term "optimizer" refers to a function that optimizes the production of this manufacturing site. It is not an optimizer used to train a CNN, for example. This optimizer is both an activation function and a regulator that was built from scratch to optimize production. This shows that you must sometimes invent the optimizer you need to generate a profitable solution for your customer or company.</p>
    <h3 id="_idParaDest-232" class="title">The optimizer as a regulator</h3>
    <p class="normal">The whole concept of this<a id="_idIndexMarker560"/> RL-DL-CRLMM of real-time production, applied to P3, is to optimize <em class="italics">Z</em> over the load distribution of the assembly stations, as explained before. This means reducing <em class="italics">Z</em> as much as possible through the following equation:</p>
    <figure class="mediaobject"><img src="../Images/B15483_11_019.png" alt=""/></figure>
    <p class="normal">To achieve this optimization goal, <em class="italics">Z</em> needs to be taken apart and applied to strategic parts of the code.</p>
    <h4 class="title">Implementing Z – squashing the MDP result matrix</h4>
    <p class="normal">The output of the MDP functions <a id="_idIndexMarker561"/>provides the following <code class="Code-In-Text--PACKT-">Q</code> matrix:</p>
    <pre class="programlisting"><code class="hljs yaml"><span class="hljs-attr">Q :</span>
<span class="hljs-string">[[</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">321.8</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-string">]</span>
 <span class="hljs-string">[</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">401</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">258.44</span><span class="hljs-string">]</span>
 <span class="hljs-string">[</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">401</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-string">]</span>
 <span class="hljs-string">[</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">500</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-string">]</span>
 <span class="hljs-string">[</span> <span class="hljs-number">258.44</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">401</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-string">]</span>
 <span class="hljs-string">[</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">321.8</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-number">0</span><span class="hljs-string">.</span> <span class="hljs-string">]]</span>
</code></pre>
    <p class="normal">Each line represents a vertex in the graph: A, B, C, D, E, and F. Each value obtained needs to be squashed in the following <em class="italics">z</em>(<em class="italics">x</em>) function:</p>
    <figure class="mediaobject"><img src="../Images/B15483_11_020.png" alt=""/></figure>
    <p class="normal">The first step in the code that follows is to squash the weights provided by the MDP process for each line (vertex) <em class="italics">x</em> with a <code class="Code-In-Text--PACKT-">logistic_sigmoid</code> function:</p>
    <pre class="programlisting"><code class="hljs ruby"><span class="hljs-comment">#Logistic Sigmoid function to squash the weights    [Line 118]</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logistic_sigmoid</span><span class="hljs-params">(w)</span></span>:
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> / (<span class="hljs-number">1</span> + math.exp(-w))
</code></pre>
    <p class="normal">The function is called by the transformation of the MDP <code class="Code-In-Text--PACKT-">Q</code> output matrix into the weight vector for each column of each line, as shown in the following code:</p>
    <pre class="programlisting"><code class="hljs angelscript">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">6</span>):    # [Line <span class="hljs-number">191</span>]
        maxw=<span class="hljs-number">0</span>
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">6</span>):
            W[j]+=logistic_sigmoid(Q[i,j])
</code></pre>
    <p class="normal">At this point, each value of the MDP has lost any real-life value. It is a weight, just as in any other network. The difference is that the whole system is controlled. In a real-life project, keeping an eye on the calculations through reports is necessary for maintenance purposes. Even an automatic system requires quality control.</p>
    <p class="normal">The MDP matrix has now <a id="_idIndexMarker562"/>been flattened into a weight matrix, as shown in the following output:</p>
    <pre class="programlisting"><code class="hljs angelscript">Vertex Weights [<span class="hljs-number">3.5</span>, <span class="hljs-number">3.5</span>, <span class="hljs-number">3.0</span>, <span class="hljs-number">5.0</span>, <span class="hljs-number">3.5</span>, <span class="hljs-number">3.5</span>]
</code></pre>
    <p class="normal">Each vertex (letter in the graph) now has a weight.</p>
    <h4 class="title">Implementing Z – squashing the vertex weights vector</h4>
    <p class="normal">Squashed <code class="Code-In-Text--PACKT-">W</code> (vertex weights) grows after each frame analysis, and each MDP run since <code class="Code-In-Text--PACKT-">W[j]+</code> is applied continuously, and <code class="Code-In-Text--PACKT-">W</code> is <a id="_idIndexMarker563"/>never set to zero.</p>
    <p class="normal">The main reasons:</p>
    <ul>
      <li class="list">Once launched, the RL-DL-CRLMM is a continuous process, with no beginning and no end as long as the conveyor belt is running.</li>
      <li class="list">The conveyor belt is sending assembly (mostly sewing) work to the assembly stations that take some time (<em class="italics">t</em>) to get the job (<em class="italics">x</em>) represented by <em class="italics">t</em><sub style="font-style: italic;">x</sub> in the <em class="italics">Z</em> equation and the <em class="italics">W</em> vector in the program.</li>
      <li class="list">Hence, work is piling up on each vertex (A to F), which represents an assembly station.</li>
    </ul>
    <p class="normal">This is why the <img src="../Images/B15483_11_021.png" alt=""/> variable in the <em class="italics">Z</em> equation is implemented, as shown in the initial equation early in the chapter, as follows:</p>
    <figure class="mediaobject"><img src="../Images/B15483_11_022.png" alt=""/></figure>
    <p class="normal"><img src="../Images/B15483_11_006.png" alt=""/> is implemented for two reasons:</p>
    <ul>
      <li class="list">The sewing or assembly stations send their finished work to the next operation on the production line, packaging, for example. So every <em class="italics">m</em> minutes, their workload goes down, and so does the load feature weight.</li>
      <li class="list">Production managers are constantly working on learning curves on assembly lines. When a new product arrives, it takes some time for the teams to adapt. Their output is a bit slower than usual. However, well-trained teams bring the learning period down regularly.</li>
    </ul>
    <p class="normal"><img src="../Images/B15483_11_024.png" alt=""/> combines both <a id="_idIndexMarker564"/>concepts in a single variable. This might be enough for some projects. If not, more work and variables need to be added.</p>
    <p class="normal">In this model, <img src="../Images/B15483_11_025.png" alt=""/> is activated by the following:</p>
    <ul>
      <li class="list"><code class="Code-In-Text--PACKT-">oif</code> represents the frequency of a <code class="Code-In-Text--PACKT-">W</code> vector <img src="../Images/B15483_11_026.png" alt=""/> update. In this example, <code class="Code-In-Text--PACKT-">oif</code> is set to <code class="Code-In-Text--PACKT-">10</code>. This means that every 10 frames, <code class="Code-In-Text--PACKT-">oir</code> will be applied.</li>
      <li class="list"><code class="Code-In-Text--PACKT-">oir</code> represents the output rate for the two reasons described before. This variable will squash the <code class="Code-In-Text--PACKT-">W</code> vector by the % given. In this example, <code class="Code-In-Text--PACKT-">oir=0.2</code>. That means that only 20% of the weights will be retained. The rest has been finished.</li>
    </ul>
    <p class="normal">The following code shows how to implement <code class="Code-In-Text--PACKT-">oif</code> and <code class="Code-In-Text--PACKT-">oir</code>:</p>
    <pre class="programlisting"><code class="hljs routeros"><span class="hljs-comment"># input_output_frequency : output every n frames/ retained memory    [Line 315]</span>
<span class="hljs-attribute">oif</span>=10
<span class="hljs-comment">#input_output_rate p% (memory retained)</span>
<span class="hljs-attribute">oir</span>=0.2
<span class="hljs-attribute">fc</span>=0 #frequency counter : memory output
<span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> range(episodes):
    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">"episode:frame #"</span>,e)
    <span class="hljs-attribute">fc</span>=fc+1
    #memory management : lambda output
    <span class="hljs-keyword">if</span>(fc&gt;=10):
        <span class="hljs-keyword">for</span> fci <span class="hljs-keyword">in</span> range(6):
            W[fci]=W[fci]*oir
            <span class="hljs-attribute">fc</span>=0
            <span class="hljs-builtin-name">print</span>(<span class="hljs-string">"OUTPUT OPERATION - MEMORY UPDATED FOR "</span>,L[fci],
                  <span class="hljs-string">" "</span>,oir,<span class="hljs-string">"% retained"</span>)
</code></pre>
    <p class="normal">The <code class="Code-In-Text--PACKT-">W</code> vector has been squashed again, as shown in this output:</p>
    <pre class="programlisting"><code class="hljs angelscript">OUTPUT OPERATION - MEMORY UPDATED FOR A <span class="hljs-number">0.2</span> % retained
OUTPUT OPERATION - MEMORY UPDATED FOR B <span class="hljs-number">0.2</span> % retained
OUTPUT OPERATION - MEMORY UPDATED FOR C <span class="hljs-number">0.2</span> % retained
OUTPUT OPERATION - MEMORY UPDATED FOR D <span class="hljs-number">0.2</span> % retained
OUTPUT OPERATION - MEMORY UPDATED FOR E <span class="hljs-number">0.2</span> % retained
OUTPUT OPERATION - MEMORY UPDATED FOR F <span class="hljs-number">0.2</span> % retained
</code></pre>
    <p class="normal">The optimizer has provided<a id="_idIndexMarker565"/> updated information on the status of each sewing station. Each sewing station is a location for the MDP function. We will now see how the MDP function uses the information provided by the optimizer.</p>
    <h3 id="_idParaDest-233" class="title">Finding the main target for the MDP function</h3>
    <p class="normal"><em class="italics">W</em>, the weight vector, is updated after <a id="_idIndexMarker566"/>each frame with a short-term memory of <em class="italics">n</em> frames. This means that in every <em class="italics">n</em> frames, its memory is emptied of useless information.</p>
    <p class="normal">The goal of the optimizer is to provide a target for the MDP function. On the first episode, since it does not have any information, the optimizer selects a random state, as shown in the following code excerpt:</p>
    <pre class="programlisting"><code class="hljs angelscript">    #first episode <span class="hljs-keyword">is</span> random
    <span class="hljs-keyword">if</span>(e==<span class="hljs-number">0</span>):
        lr=random.randint(<span class="hljs-number">0</span>,<span class="hljs-number">5</span>)
</code></pre>
    <p class="normal">This means that a random assembly station will be chosen on the MDP graph, which represents the six assembly sewing stations. Once this episode has been completed, the system enters a circular real-time cycle (refer to the next section).</p>
    <p class="normal">The second episode has the <code class="Code-In-Text--PACKT-">W</code> vector to rely upon.</p>
    <p class="normal">This runs the <code class="Code-In-Text--PACKT-">crlmm</code> (described before) CNN-CRLMM network to determine whether the frame has a gap or no-gap feature, as shown in the following code:</p>
    <pre class="programlisting"><code class="hljs reasonml">    crlmm=<span class="hljs-constructor">CRLMM(Q,<span class="hljs-params">lr</span>,<span class="hljs-params">e</span>)</span>    # <span class="hljs-literal">[L<span class="hljs-identifier">ine</span> <span class="hljs-number">388</span>]</span>
</code></pre>
    <p class="normal">The optimizer will use <code class="Code-In-Text--PACKT-">W</code> to:</p>
    <ul>
      <li class="list">Choose the vertex (sewing station) with <em class="italics">somewhat</em> the smallest weight if the CNN on the frame produces a result with <code class="Code-In-Text--PACKT-">no gap</code> (probability is zero). Since there is no gap, this means that there are many pieces to sew. Thus, it is much better to give the work to an assembly station that has a lower load than others.</li>
      <li class="list">Choose the vertex (sewing station) with <em class="italics">somewhat</em> the highest weight if the CNN on the frame produces a result with a <code class="Code-In-Text--PACKT-">gap</code> (probability is one). Since there is a gap, it means there are not that many pieces to sew. Thus, it is much better to give the work to an assembly station that already has a higher workload. It will balance the loads and optimize the load distribution over all the stations.</li>
      <li class="list">Introduce a choice to<a id="_idIndexMarker567"/> find one target assembly station for the MDP function in each of these cases. It will look for stations (vertices, letters, dots in the graph) with the highest weight in one case and the lowest in another.</li>
      <li class="list">Add the <em class="italics">somewhat</em> concept referred to before. The system must remain relatively free, or it will keep choosing the same best sewing stations, depriving others of work. Thus, each possibility (<code class="Code-In-Text--PACKT-">gap</code> or <code class="Code-In-Text--PACKT-">no gap</code>) is limited to a random choice of only three among the six locations for each weight class (higher or lower).</li>
    </ul>
    <p class="normal">The optimizing function, shown in the following snippet, can prove extremely profitable on real-life industrial production lines:</p>
    <pre class="programlisting"><code class="hljs routeros">    <span class="hljs-keyword">if</span>(e&gt;0):
        <span class="hljs-attribute">lr</span>=0
        <span class="hljs-attribute">minw</span>=10000000
        <span class="hljs-attribute">maxw</span>=-1
        #<span class="hljs-literal">no</span> G =&gt; Finding the largest gap (most loaded<span class="hljs-built_in"> resource </span><span class="hljs-keyword">or</span> a distance)
        <span class="hljs-keyword">if</span>(<span class="hljs-attribute">crlmm</span>==0):
            <span class="hljs-keyword">for</span> wi <span class="hljs-keyword">in</span> range(3):
                <span class="hljs-attribute">op</span>=random.randint(0,5)
                <span class="hljs-keyword">if</span>(W[op]&lt;minw):
                    <span class="hljs-attribute">lr</span>=op;minw=W[op]
        #G =&gt; Finding the smallest gap (a least loaded<span class="hljs-built_in"> resource </span><span class="hljs-keyword">or</span> a distance)
        <span class="hljs-keyword">if</span>(<span class="hljs-attribute">crlmm</span>==1):
            <span class="hljs-keyword">for</span> wi <span class="hljs-keyword">in</span> range(3):
                <span class="hljs-attribute">op</span>=random.randint(0,5)
                <span class="hljs-keyword">if</span>(W[op]&gt;maxw):
                    <span class="hljs-attribute">lr</span>=op;maxw=W[op]
</code></pre>
    <p class="normal"><code class="Code-In-Text--PACKT-">lr</code> is the main location chosen for the MDP reinforcement learning function, as shown in the following code:</p>
    <pre class="programlisting"><code class="hljs vim">    <span class="hljs-keyword">print</span>(<span class="hljs-string">"LR TARGET STATE MDP number and letter:"</span>,<span class="hljs-keyword">lr</span>,L[<span class="hljs-keyword">lr</span>])
</code></pre>
    <p class="normal">Reinforcement learning has to run every time since it faces new frames in the continuous process of the conveyor belt in the automated apparel system.</p>
    <p class="normal">Now, the MDP reward matrix is reset to its initial state, as implemented in these lines of the program:</p>
    <pre class="programlisting"><code class="hljs mipsasm">    <span class="hljs-comment">#initial reward matrix set again</span>
    for <span class="hljs-keyword">ei </span>in range(<span class="hljs-number">6</span>):
        for ej in range(<span class="hljs-number">6</span>):
            Q[<span class="hljs-keyword">ei,ej]=0
</span>            if(<span class="hljs-keyword">ei </span>!=lr):
                R[<span class="hljs-keyword">ei,ej]=Ri[ei,ej]
</span>            if(<span class="hljs-keyword">ei </span>==lr):
                R[<span class="hljs-keyword">ei,ej]=0 </span><span class="hljs-comment">#to target, not from</span>
</code></pre>
    <p class="normal">The target location is <a id="_idIndexMarker568"/>initialized with a value that fits the gap or no-gap philosophy of the program. If there is no gap, the value is higher, and so will be the weight (represented load of the station) in the end. If there is a gap, the value is lower, and so will be the weight for that station, as shown in the following lines of code:</p>
    <pre class="programlisting"><code class="hljs routeros">    #<span class="hljs-literal">no</span> G
    <span class="hljs-attribute">rew</span>=100
    #G
    <span class="hljs-keyword">if</span>(<span class="hljs-attribute">crlmm</span>==1):
        <span class="hljs-attribute">rew</span>=50
    R[lr,lr]=rew
    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">"Initial Reward matrix with vertex locations:"</span>,R)
</code></pre>
    <p class="normal">We just explored the MDP process. However, the overall program we are looking at is a circular process that runs 24/7. At a given time, all of the components of our AI program are running at the same time. Let's see how.</p>
    <h2 id="_idParaDest-234" class="title">A circular model – a stream-like system that never starts nor ends</h2>
    <p class="normal">We have successfully converted <a id="_idIndexMarker569"/>the linear stream of production (conveyor belt, optimizer, and sewing stations) into a circular process.</p>
    <p class="normal">Since the RL-DL-CRLMM model runs nonstop, it can run at all of the following points at the same time:</p>
    <ul>
      <li class="list">A = Captures a frame of the output of the cutting section with a webcam and a CNN-CRLMM</li>
      <li class="list">B = Analyzes the load (histograms of each sewing section) with the CRLMM</li>
      <li class="list">C = Optimizes the sewing stations with an MDP</li>
    </ul>
    <p class="normal">ABC is one flow. But since<a id="_idIndexMarker570"/> each process is running nonstop, we can see all of the following flows at the same time: A, B, C or B, C, A or C, A, B.</p>
    <p class="normal">The following graph represents the circular process:</p>
    <figure class="mediaobject"><img src="../Images/B15438_11_10.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.10: Circular RL-DL-CRLMM</p>
    <p class="normal">The diagram describes an automatic process. However, let's go back a step and imagine we are in a factory in which humans still make the decisions. The process is circular, which means it never stops or starts. It runs 24/7. We will suppose a floor manager is an optimizer represented by the blue bar charts. The floor manager will look at the sewing stations to see who has a lot of work to do and who has little work to do. Then the floor manager will observe the conveyor belt (the web frame with the image of the packs) that is bringing packs of cut cloth to sew into garments. The floor manager will select several packs where there is a gap on the conveyor belt for the least loaded sewing stations, for example. Once the choice has been made, the floor manager will direct the packs to the right sewing <a id="_idIndexMarker571"/>station following calculating the graph (MDP) manually.</p>
    <p class="normal">Let's explore these steps in further detail.</p>
    <p class="normal"><strong class="bold">Step X</strong>: When the following frame arrives, the CRL-CNN is activated:</p>
    <figure class="mediaobject"><img src="../Images/B15438_11_11.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.11: The CRL-CNN gets activated</p>
    <p class="normal">The solution calls the <code class="Code-In-Text--PACKT-">CRLMM</code> function, as shown in the following code:</p>
    <pre class="programlisting"><code class="hljs routeros">    <span class="hljs-attribute">crlmm</span>=CRLMM(Q,lr,e)    # [Line 388]
    <span class="hljs-builtin-name">print</span>(<span class="hljs-string">"GAP =0 or GAP =1 status: "</span>,crlmm)
</code></pre>
    <p class="normal">The following output displays the status of the image: <code class="Code-In-Text--PACKT-">gap</code>, <code class="Code-In-Text--PACKT-">no gap</code>:</p>
    <pre class="programlisting"><code class="hljs lua">image dataset/classify/img1.jpg predict_probability: <span class="hljs-string">[[ 0.]]</span> prediction: <span class="hljs-string">[[ 0.]]</span>
Classified <span class="hljs-keyword">in</span> class A
Productive
Seeking...
GAP =<span class="hljs-number">0</span> <span class="hljs-keyword">or</span> GAP =<span class="hljs-number">1</span> <span class="hljs-built_in">status</span>: <span class="hljs-number">0</span>
</code></pre>
    <p class="normal">The following weights of each sewing station (vertices A to F) are taken into account:</p>
    <pre class="programlisting"><code class="hljs less">    <span class="hljs-selector-tag">MDP_GRAPH</span>(lr,e)    # <span class="hljs-selector-attr">[Line 390]</span>
    <span class="hljs-selector-tag">print</span>(<span class="hljs-string">"Vertex Weights"</span>,W)
</code></pre>
    <p class="normal">The program displays them in text form:</p>
    <pre class="programlisting"><code class="hljs angelscript">Vertex Weights [<span class="hljs-number">9.4</span>, <span class="hljs-number">11.100000000000001</span>, <span class="hljs-number">10.2</span>, <span class="hljs-number">12.0</span>, <span class="hljs-number">11.7</span>, <span class="hljs-number">10.0</span>]
</code></pre>
    <p class="normal">The program also displays the following bar chart of the weights of each sewing station:</p>
    <figure class="mediaobject"><img src="../Images/B15438_11_12.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.12: Bar chart of the weighs of each sewing station</p>
    <p class="normal">The <strong class="bold">STEP X+1</strong> optimizer<a id="_idIndexMarker572"/> analyzes the weights to make a decision: send small quantities to the sewing stations that have a lot of work and large quantities to sewing stations that have less work to do.</p>
    <p class="normal">By doing this, the optimizer makes sure that each sewing station has an optimal workload. If a sewing station has a lot of work piling up, it makes sense to give a large amount of incoming work to a sewing station with little work to do. That way, all of the sewing stations will be working at full capacity.</p>
    <p class="normal"><img src="../Images/B15438_10_023.png" alt=""/> (gamma) has now reached a point at which it understands that a gap is a comparison between two states and inference of a conceptual distance:</p>
    <ul>
      <li class="list"><strong class="bold">Overloading</strong>: Too much</li>
      <li class="list"><strong class="bold">Underloading</strong>: Not enough</li>
    </ul>
    <p class="normal"><img src="../Images/B15483_11_028.png" alt=""/> now contains two abstract concepts:</p>
    <ul>
      <li class="list">Enough to too much</li>
      <li class="list">Not enough to lacking</li>
    </ul>
    <div class="note">
      <p class="Information-Box--PACKT-">The goal of the circular process is to keep the bars at an approximately similar height—not an exact height, but also not a situation in which A would have no work to do, and E would be overloaded.</p>
    </div>
    <p class="normal"><strong class="bold">STEP X+2</strong>: The MDP, as <a id="_idIndexMarker573"/>described in this chapter, receives instructions to optimize a given sewing station and spreads work out to its neighbors. This is often a production constraint: one station sews the sleeves of a T-shirt. For example, the station nearby sews a pocket on the T-shirt. The MDP spreads out the work, starting with the target location. In this case, the target location is one of the sewing stations in the A-E-D area (the area is displayed in color when you run the Python program) as shown in the following graph:</p>
    <figure class="mediaobject"><img src="../Images/B15438_11_13.png" alt=""/></figure>
    <p class="packt_figref">Figure 11.13: MDP spreads out</p>
    <p class="normal">The MDP sends its results directly to the conveyor belt, which automatically follows the path instructions sent to it.</p>
    <p class="normal">Then, the MDP updates the weights, empties its reward matrix, and waits for a new one. The system goes back to step X.</p>
    <p class="normal">As you might have noticed, no human operator is involved in this entire process at all.</p>
    <h1 id="_idParaDest-235" class="title">Summary</h1>
    <p class="normal">Applying artificial intelligence to Amazon's real-time sales, production, and delivery forces projects into reality.</p>
    <p class="normal">Learning machine learning and deep learning with MNIST, CIFAR, and other ready-to-use datasets with ready-to-use programs is a prerequisite to mastering artificial intelligence. Learning mathematics is a must.</p>
    <p class="normal">Building a few programs that can do various theoretical things cannot be avoided. However, managing a real project under corporate pressure will bring an AI specialist up to another level. The AI specialist will have to put AI theory into practice. The constraints of corporate specifications make machine learning projects exciting. During those projects, experts learn valuable information on how AI solutions work and can be improved.</p>
    <p class="normal">This chapter described an RL-DL-CRLMM model with an optimizer. We learned how the market is evolving from planning manufacturing in advance to real-time planning challenging classical processes. We saw that a consumer wants to receive a purchased product as soon as possible. If that product is not available to demand, it must be produced in nearly real-time and delivered to the customer. To automate this process, we built a Python program that can scan an apparel conveyor built to detect gaps in a cutting process with a CNN, use an optimizing function to choose the best sewing workstation and then build a graph with MDP to represent the optimized path taken.</p>
    <p class="normal">The next chapter explores an application of this solution with an SVM applied to a self-driving car situation in an IoT context, Swarm AI, and elementary AGI.</p>
    <h1 id="_idParaDest-236" class="title">Questions</h1>
    <ol>
      <li class="list">A CNN can be trained to understand an abstract concept? (Yes | No)</li>
      <li class="list">Is it better to avoid concepts and only use real-life images? (Yes | No)</li>
      <li class="list">Do planning and scheduling mean the same thing? (Yes | No)</li>
      <li class="list">Is Amazon's manufacturing patent a revolution? (Yes | No)</li>
      <li class="list">Learning how warehouses function is not useful. (Yes | No)</li>
      <li class="list">Online marketing does not require artificial intelligence. (Yes | No)</li>
    </ol>
    <h1 id="_idParaDest-237" class="title">Further reading</h1>
    <ul>
      <li class="list">More information on Amazon's apparel manufacturing innovation and apparel market can be found here: <a href="https://www.nytimes.com/2017/04/30/technology/detailing-amazons-custom-clothing-patent.html"><span class="url">https://www.nytimes.com/2017/04/30/technology/detailing-amazons-custom-clothing-patent.html</span></a>, <a href="https://www.amazon.com/learn-more-prime-wardrobe/b?ie=UTF8&amp;node=16122413011"><span class="url">https://www.amazon.com/learn-more-prime-wardrobe/b?ie=UTF8&amp;node=16122413011</span></a></li>
    </ul>
  </div>
</body></html>